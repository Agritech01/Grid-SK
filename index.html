<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡πâ‡∏≠‡∏¢ - Dashboard</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --gray: #95a5a6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Kanit', 'Sarabun', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }
        
        /* Header */
        .dashboard-header {
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: white;
            padding: 25px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header-title {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .header-title h1 {
            font-size: 28px;
            font-weight: 600;
        }
        
        .header-stats {
            display: flex;
            gap: 30px;
        }
        
        .stat-box {
            text-align: center;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #f1c40f;
        }
        
        .stat-label {
            font-size: 14px;
            opacity: 0.9;
            margin-top: 5px;
        }
        
        /* Main Content */
        .dashboard-content {
            display: grid;
            grid-template-columns: 300px 1fr;
            min-height: 800px;
        }
        
        /* Sidebar */
        .sidebar {
            background: var(--light);
            padding: 30px 0;
            border-right: 1px solid #ddd;
        }
        
        .nav-menu {
            list-style: none;
        }
        
        .nav-item {
            padding: 20px 30px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 15px;
            border-left: 5px solid transparent;
        }
        
        .nav-item:hover {
            background: rgba(52, 152, 219, 0.1);
        }
        
        .nav-item.active {
            background: rgba(52, 152, 219, 0.15);
            border-left-color: var(--secondary);
            color: var(--secondary);
            font-weight: 600;
        }
        
        .nav-icon {
            font-size: 20px;
            width: 30px;
            text-align: center;
        }
        
        /* Main Panel */
        .main-panel {
            padding: 30px;
            overflow-y: auto;
            max-height: 800px;
        }
        
        .panel-title {
            font-size: 24px;
            color: var(--primary);
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .panel-title span {
            color: var(--secondary);
        }
        
        /* Upload Panel */
        .upload-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }
        
        .upload-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .upload-card {
            background: var(--light);
            border-radius: 10px;
            padding: 25px;
            border: 2px dashed #bdc3c7;
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .upload-card.required {
            border-color: var(--danger);
            background: rgba(231, 76, 60, 0.05);
        }
        
        .upload-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: var(--secondary);
        }
        
        .card-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .card-icon {
            width: 50px;
            height: 50px;
            background: var(--secondary);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
        }
        
        .required .card-icon {
            background: var(--danger);
        }
        
        .card-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--primary);
        }
        
        .required-tag {
            background: var(--danger);
            color: white;
            padding: 3px 10px;
            border-radius: 4px;
            font-size: 12px;
            position: absolute;
            top: -10px;
            right: 15px;
        }
        
        .file-info {
            color: var(--gray);
            font-size: 14px;
            margin-top: 10px;
        }
        
        .file-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #bdc3c7;
        }
        
        .status-indicator.uploaded {
            background: var(--success);
        }
        
        .upload-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }
        
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--secondary), #2980b9);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        
        .btn-secondary {
            background: var(--light);
            color: var(--primary);
        }
        
        .btn-secondary:hover {
            background: #d5dbdb;
        }
        
        .btn-success {
            background: linear-gradient(135deg, var(--success), #229954);
            color: white;
        }
        
        /* Analysis Dashboard */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .metric-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.08);
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
        }
        
        .metric-card.green::before { background: var(--success); }
        .metric-card.blue::before { background: var(--secondary); }
        .metric-card.orange::before { background: var(--warning); }
        .metric-card.red::before { background: var(--danger); }
        
        .metric-value {
            font-size: 36px;
            font-weight: 700;
            margin: 10px 0;
        }
        
        .metric-label {
            color: var(--gray);
            font-size: 14px;
        }
        
        /* Heatmap Grid */
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin: 20px 0;
        }
        
        .heatmap-cell {
            aspect-ratio: 1;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
            color: white;
        }
        
        .heatmap-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .heatmap-cell.green { background: var(--success); }
        .heatmap-cell.blue { background: var(--secondary); }
        .heatmap-cell.orange { background: var(--warning); }
        .heatmap-cell.red { background: var(--danger); }
        
        /* Grid Details */
        .grid-details-header {
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .grid-selector {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 16px;
            width: 200px;
        }
        
        .grid-selector option {
            color: var(--primary);
        }
        
        .grid-info-container {
            background: white;
            border-radius: 0 0 15px 15px;
            padding: 30px;
            margin-bottom: 30px;
        }
        
        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .info-item {
            background: var(--light);
            padding: 20px;
            border-radius: 10px;
        }
        
        .info-label {
            color: var(--gray);
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .info-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary);
        }
        
        /* Critical Plots */
        .critical-plots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .plot-card {
            background: white;
            border: 2px solid var(--danger);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .plot-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(231, 76, 60, 0.2);
        }
        
        .season-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .season-6768 { background: #3498db; color: white; }
        .season-6869 { background: #9b59b6; color: white; }
        
        /* Alert Container */
        .alert-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            max-width: 400px;
        }
        
        .alert {
            background: white;
            border-left: 5px solid var(--success);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            transform: translateX(120%);
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        
        .alert.show {
            transform: translateX(0);
        }
        
        .alert.error { border-left-color: var(--danger); }
        .alert.warning { border-left-color: var(--warning); }
        .alert.info { border-left-color: var(--secondary); }
        
        /* Loading */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        .spinner {
            width: 70px;
            height: 70px;
            border: 5px solid rgba(255, 255, 255, 0.1);
            border-top: 5px solid var(--secondary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Responsive */
        @media (max-width: 1024px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            
            .sidebar {
                display: none;
            }
            
            .upload-grid {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }
            
            .header-stats {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .upload-actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600;700&family=Sarabun:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- Alert Container -->
    <div class="alert-container" id="alertContainer"></div>
    
    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <div style="color: white; margin-left: 20px;">
            <h3>‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</h3>
            <p id="loadingMessage">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà</p>
        </div>
    </div>
    
    <!-- Main Dashboard -->
    <div class="dashboard-container">
        <!-- Header -->
        <div class="dashboard-header">
            <div class="header-title">
                <div style="font-size: 32px;">üåæ</div>
                <div>
                    <h1>‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡πâ‡∏≠‡∏¢</h1>
                    <p style="opacity: 0.9;">Dashboard ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</p>
                </div>
            </div>
            
            <div class="header-stats">
                <div class="stat-box">
                    <div class="stat-value" id="headerGrids">0</div>
                    <div class="stat-label">Grid ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="headerPlots">0</div>
                    <div class="stat-label">‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="headerProblems">0</div>
                    <div class="stat-label">‡πÅ‡∏õ‡∏•‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
                </div>
                <div class="stat-box">
                    <div class="stat-value" id="headerYield">0</div>
                    <div class="stat-label">‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                </div>
            </div>
        </div>
        
        <!-- Main Content -->
        <div class="dashboard-content">
            <!-- Sidebar Navigation -->
            <div class="sidebar">
                <ul class="nav-menu">
                    <li class="nav-item active" onclick="showPanel('upload')">
                        <div class="nav-icon">üìÅ</div>
                        <div>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå</div>
                    </li>
                    <li class="nav-item" onclick="showPanel('analysis')">
                        <div class="nav-icon">üìä</div>
                        <div>‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Dashboard</div>
                    </li>
                    <li class="nav-item" onclick="showPanel('heatmap')">
                        <div class="nav-icon">üó∫Ô∏è</div>
                        <div>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô</div>
                    </li>
                    <li class="nav-item" onclick="showPanel('gridDetails')">
                        <div class="nav-icon">üîç</div>
                        <div>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Grid</div>
                    </li>
                    <li class="nav-item" onclick="showPanel('reports')">
                        <div class="nav-icon">üìà</div>
                        <div>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</div>
                    </li>
                </ul>
                
                <div style="padding: 30px; border-top: 1px solid #ddd; margin-top: 20px;">
                    <h4 style="color: var(--primary); margin-bottom: 15px;">‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î</h4>
                    <ul style="list-style: none; font-size: 14px; color: var(--gray);">
                        <li style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            ‡πÑ‡∏ü‡∏•‡πå GRID ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÄ‡∏™‡∏°‡∏≠
                        </li>
                        <li style="margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            ‡πÑ‡∏ü‡∏•‡πå KAT ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÑ‡∏ü‡∏•‡πå
                        </li>
                        <li style="display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-check-circle" style="color: var(--success);"></i>
                            ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏î‡πâ‡∏ó‡∏±‡πâ‡∏á 2 ‡πÑ‡∏ü‡∏•‡πå KAT
                        </li>
                    </ul>
                </div>
            </div>
            
            <!-- Main Panel Content -->
            <div class="main-panel">
                <!-- Upload Panel -->
                <div id="uploadPanel" class="panel active">
                    <div class="panel-title">
                        <span>üìÅ</span> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </div>
                    
                    <div class="upload-container">
                        <div class="upload-grid">
                            <!-- GRID File -->
                            <div class="upload-card required" onclick="openFilePicker('gridFile')">
                                <div class="required-tag">‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö</div>
                                <div class="card-header">
                                    <div class="card-icon">
                                        <i class="fas fa-map"></i>
                                    </div>
                                    <div>
                                        <div class="card-title">‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GRID</div>
                                        <div class="file-info">CSV ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Grid, landno, ‡πÄ‡∏Ç‡∏ï, ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£, ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£, ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡πâ‡∏≠‡∏¢</div>
                                    </div>
                                </div>
                                <div class="file-status">
                                    <div class="status-indicator" id="gridStatus"></div>
                                    <span id="gridFileName">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                                </div>
                                <input type="file" id="gridFile" accept=".csv" style="display: none;" onchange="handleFileSelect('grid', this)">
                            </div>
                            
                            <!-- KAT 67/68 File -->
                            <div class="upload-card" onclick="openFilePicker('kat6768File')">
                                <div class="card-header">
                                    <div class="card-icon" style="background: #3498db;">
                                        <i class="fas fa-calendar-alt"></i>
                                    </div>
                                    <div>
                                        <div class="card-title">‡πÑ‡∏ü‡∏•‡πå KAT 67/68</div>
                                        <div class="file-info">CSV ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Grid, ‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech, ‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤, ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà, ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                                    </div>
                                </div>
                                <div class="file-status">
                                    <div class="status-indicator" id="kat6768Status"></div>
                                    <span id="kat6768FileName">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                                </div>
                                <input type="file" id="kat6768File" accept=".csv" style="display: none;" onchange="handleFileSelect('kat6768', this)">
                            </div>
                            
                            <!-- KAT 68/69 File -->
                            <div class="upload-card" onclick="openFilePicker('kat6869File')">
                                <div class="card-header">
                                    <div class="card-icon" style="background: #9b59b6;">
                                        <i class="fas fa-calendar-check"></i>
                                    </div>
                                    <div>
                                        <div class="card-title">‡πÑ‡∏ü‡∏•‡πå KAT 68/69</div>
                                        <div class="file-info">CSV ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå Grid, ‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech, ‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤, ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà, ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</div>
                                    </div>
                                </div>
                                <div class="file-status">
                                    <div class="status-indicator" id="kat6869Status"></div>
                                    <span id="kat6869FileName">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå</span>
                                </div>
                                <input type="file" id="kat6869File" accept=".csv" style="display: none;" onchange="handleFileSelect('kat6869', this)">
                            </div>
                        </div>
                        
                        <div class="upload-actions">
                            <button class="btn btn-secondary" onclick="clearAllFiles()">
                                <i class="fas fa-trash-alt"></i> ‡∏•‡πâ‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                            </button>
                            <button class="btn btn-primary" onclick="validateAndAnalyze()">
                                <i class="fas fa-play"></i> ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Analysis Dashboard -->
                <div id="analysisPanel" class="panel" style="display: none;">
                    <div class="panel-title">
                        <span>üìä</span> ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏° Dashboard
                    </div>
                    
                    <!-- Summary Cards -->
                    <div class="dashboard-grid">
                        <div class="metric-card green">
                            <div class="metric-value" id="totalGridCount">0</div>
                            <div class="metric-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô Grid ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå GRID
                            </div>
                        </div>
                        
                        <div class="metric-card blue">
                            <div class="metric-value" id="kat6768Plots">0</div>
                            <div class="metric-label">‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 67/68</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå KAT 67/68
                            </div>
                        </div>
                        
                        <div class="metric-card blue">
                            <div class="metric-value" id="kat6869Plots">0</div>
                            <div class="metric-label">‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 68/69</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå KAT 68/69
                            </div>
                        </div>
                        
                        <div class="metric-card orange">
                            <div class="metric-value" id="matchedPlots">0</div>
                            <div class="metric-label">‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                landno ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡πÑ‡∏ü‡∏•‡πå
                            </div>
                        </div>
                        
                        <div class="metric-card red">
                            <div class="metric-value" id="criticalPlots">0</div>
                            <div class="metric-label">‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                ‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà
                            </div>
                        </div>
                        
                        <div class="metric-card green">
                            <div class="metric-value" id="avgYield">0.0</div>
                            <div class="metric-label">‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                            <div style="margin-top: 15px; font-size: 14px; color: var(--gray);">
                                ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà
                            </div>
                        </div>
                    </div>
                    
                    <!-- Data Summary -->
                    <div class="upload-container">
                        <h3 style="color: var(--primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                            <i class="fas fa-info-circle" style="color: var(--secondary);"></i>
                            ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå
                        </h3>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 15px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå GRID</h4>
                                <div id="gridSummary" style="color: var(--gray); font-size: 14px; line-height: 1.6;">
                                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå
                                </div>
                            </div>
                            
                            <div>
                                <h4 style="color: var(--primary); margin-bottom: 15px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå KAT</h4>
                                <div id="katSummary" style="color: var(--gray); font-size: 14px; line-height: 1.6;">
                                    ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå
                                </div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; padding: 20px; background: #e8f4fc; border-radius: 10px;">
                            <h4 style="color: var(--primary); margin-bottom: 15px; display: flex; align-items: center; gap: 10px;">
                                <i class="fas fa-lightbulb" style="color: var(--warning);"></i>
                                ‡∏´‡∏•‡∏±‡∏Å‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå
                            </h4>
                            <p style="color: var(--gray); line-height: 1.6;">
                                1. ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå <strong>Grid</strong> ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GRID ‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å<br>
                                2. ‡πÉ‡∏ä‡πâ <strong>landno</strong> ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GRID ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö <strong>‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech</strong> ‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå KAT<br>
                                3. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå GRID: ‡πÄ‡∏Ç‡∏ï, ‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£, ‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£, ‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà, ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡πâ‡∏≠‡∏¢<br>
                                4. ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå KAT: ‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤, ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà, ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà<br>
                                5. ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÉ‡∏ô‡∏£‡∏∞‡∏î‡∏±‡∏ö Grid ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏´‡∏≤‡∏õ‡∏±‡∏ç‡∏´‡∏≤
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Heatmap Panel -->
                <div id="heatmapPanel" class="panel" style="display: none;">
                    <div class="panel-title">
                        <span>üó∫Ô∏è</span> ‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï
                    </div>
                    
                    <div class="upload-container">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                            <div>
                                <h3 style="color: var(--primary);">‡πÅ‡∏™‡∏î‡∏á Grid ‡∏ï‡∏≤‡∏°‡πÄ‡∏Å‡∏£‡∏î‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï</h3>
                                <p style="color: var(--gray); margin-top: 5px;">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà Grid ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                            </div>
                            
                            <div style="display: flex; gap: 10px;">
                                <button class="btn" style="background: var(--success); color: white;" onclick="filterHeatmap('all')">
                                    ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                                </button>
                                <button class="btn" style="background: var(--success); color: white;" onclick="filterHeatmap('high')">
                                    üü¢ ‡∏™‡∏π‡∏á
                                </button>
                                <button class="btn" style="background: #f1c40f; color: white;" onclick="filterHeatmap('medium')">
                                    üü° ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á
                                </button>
                                <button class="btn" style="background: var(--warning); color: white;" onclick="filterHeatmap('improve')">
                                    üü† ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á
                                </button>
                                <button class="btn" style="background: var(--danger); color: white;" onclick="filterHeatmap('low')">
                                    üî¥ ‡∏ï‡πà‡∏≥
                                </button>
                            </div>
                        </div>
                        
                        <div class="heatmap-grid" id="heatmapContainer">
                            <!-- Heatmap cells will be generated here -->
                            <div style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--gray);">
                                <i class="fas fa-map" style="font-size: 48px; margin-bottom: 15px;"></i>
                                <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô</h3>
                                <p>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡∏ß‡∏≤‡∏°‡∏£‡πâ‡∏≠‡∏ô</p>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div style="background: rgba(39, 174, 96, 0.1); padding: 15px; border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; background: var(--success); border-radius: 4px;"></div>
                                    <div style="font-weight: 600; color: var(--primary);">‡∏™‡∏π‡∏á (>15 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà)</div>
                                </div>
                                <div id="highCount" style="font-size: 24px; font-weight: 700; color: var(--success);">0</div>
                            </div>
                            
                            <div style="background: rgba(241, 196, 15, 0.1); padding: 15px; border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; background: #f1c40f; border-radius: 4px;"></div>
                                    <div style="font-weight: 600; color: var(--primary);">‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (10-15)</div>
                                </div>
                                <div id="mediumCount" style="font-size: 24px; font-weight: 700; color: #f1c40f;">0</div>
                            </div>
                            
                            <div style="background: rgba(243, 156, 18, 0.1); padding: 15px; border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; background: var(--warning); border-radius: 4px;"></div>
                                    <div style="font-weight: 600; color: var(--primary);">‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (7-10)</div>
                                </div>
                                <div id="improveCount" style="font-size: 24px; font-weight: 700; color: var(--warning);">0</div>
                            </div>
                            
                            <div style="background: rgba(231, 76, 60, 0.1); padding: 15px; border-radius: 10px;">
                                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                                    <div style="width: 20px; height: 20px; background: var(--danger); border-radius: 4px;"></div>
                                    <div style="font-weight: 600; color: var(--primary);">‡∏ï‡πà‡∏≥ (<7)</div>
                                </div>
                                <div id="lowCount" style="font-size: 24px; font-weight: 700; color: var(--danger);">0</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Grid Details Panel -->
                <div id="gridDetailsPanel" class="panel" style="display: none;">
                    <div class="panel-title">
                        <span>üîç</span> ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î Grid
                    </div>
                    
                    <div class="grid-details-header">
                        <div>
                            <h3 style="color: white;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Grid ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</h3>
                            <p style="opacity: 0.9; margin-top: 5px;">‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï</p>
                        </div>
                        
                        <select class="grid-selector" id="gridSelector" onchange="loadGridDetails(this.value)">
                            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Grid --</option>
                        </select>
                    </div>
                    
                    <div class="grid-info-container">
                        <div id="gridDetailsContent">
                            <div style="text-align: center; padding: 50px; color: var(--gray);">
                                <i class="fas fa-map-marked-alt" style="font-size: 64px; margin-bottom: 20px;"></i>
                                <h3>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Grid</h3>
                                <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å Grid ‡∏à‡∏≤‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Reports Panel -->
                <div id="reportsPanel" class="panel" style="display: none;">
                    <div class="panel-title">
                        <span>üìà</span> ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div class="metric-card blue">
                            <div class="metric-value" id="reportGrids">0</div>
                            <div class="metric-label">Grid ‡∏ó‡∏µ‡πà‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡πÅ‡∏•‡πâ‡∏ß</div>
                        </div>
                        
                        <div class="metric-card orange">
                            <div class="metric-value" id="reportProblems">0</div>
                            <div class="metric-label">Grid ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤</div>
                        </div>
                        
                        <div class="metric-card red">
                            <div class="metric-value" id="reportCritical">0</div>
                            <div class="metric-label">‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
                        </div>
                    </div>
                    
                    <div class="upload-container">
                        <h3 style="color: var(--primary); margin-bottom: 20px;">‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</h3>
                        
                        <div id="recommendations" style="line-height: 1.6;">
                            <div style="background: rgba(231, 76, 60, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--danger);">
                                <h4 style="color: var(--danger); margin-bottom: 10px;">
                                    <i class="fas fa-exclamation-triangle"></i> ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                                </h4>
                                <ul style="color: var(--gray); padding-left: 20px;">
                                    <li>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(243, 156, 18, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--warning);">
                                <h4 style="color: var(--warning); margin-bottom: 10px;">
                                    <i class="fas fa-clipboard-check"></i> ‡∏Ñ‡∏ß‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                                </h4>
                                <ul style="color: var(--gray); padding-left: 20px;">
                                    <li>‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞</li>
                                </ul>
                            </div>
                            
                            <div style="background: rgba(39, 174, 96, 0.1); padding: 20px; border-radius: 10px; border-left: 5px solid var(--success);">
                                <h4 style="color: var(--success); margin-bottom: 10px;">
                                    <i class="fas fa-chart-line"></i> ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
                                </h4>
                                <ul style="color: var(--gray); padding-left: 20px;">
                                    <li>‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</li>
                                </ul>
                            </div>
                        </div>
                        
                        <div style="margin-top: 30px; display: flex; gap: 15px;">
                            <button class="btn btn-success" onclick="exportPDFReport()">
                                <i class="fas fa-file-pdf"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF
                            </button>
                            <button class="btn btn-primary" onclick="exportExcelReport()">
                                <i class="fas fa-file-excel"></i> ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- JavaScript -->
    <script>
        // Global Variables
        let uploadedFiles = {
            grid: null,
            kat6768: null,
            kat6869: null
        };
        
        let analysisData = null;
        let currentPanel = 'upload';
        
        // Show Alert Function
        function showAlert(message, type = 'info') {
            const alertContainer = document.getElementById('alertContainer');
            const alertId = 'alert-' + Date.now();
            
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert ${type}`;
            alertDiv.id = alertId;
            alertDiv.innerHTML = `
                <div>
                    <i class="fas ${type === 'error' ? 'fa-times-circle' : type === 'warning' ? 'fa-exclamation-triangle' : 'fa-check-circle'}" 
                       style="font-size: 24px; color: ${type === 'error' ? 'var(--danger)' : type === 'warning' ? 'var(--warning)' : 'var(--success)'};"></i>
                </div>
                <div style="flex: 1;">
                    <div style="font-weight: 600; color: var(--primary);">${type === 'error' ? '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î' : type === 'warning' ? '‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô' : '‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à'}</div>
                    <div style="color: var(--gray); margin-top: 5px;">${message}</div>
                </div>
                <button onclick="closeAlert('${alertId}')" style="background: none; border: none; color: var(--gray); cursor: pointer;">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            alertContainer.appendChild(alertDiv);
            
            // Show with animation
            setTimeout(() => {
                alertDiv.classList.add('show');
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                closeAlert(alertId);
            }, 5000);
        }
        
        function closeAlert(alertId) {
            const alert = document.getElementById(alertId);
            if (alert) {
                alert.classList.remove('show');
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.parentNode.removeChild(alert);
                    }
                }, 500);
            }
        }
        
        // Panel Navigation
        function showPanel(panelId) {
            // Hide all panels
            document.querySelectorAll('.panel').forEach(panel => {
                panel.style.display = 'none';
            });
            
            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Show selected panel
            document.getElementById(panelId + 'Panel').style.display = 'block';
            
            // Activate corresponding nav item
            document.querySelectorAll('.nav-item').forEach((item, index) => {
                const panelOrder = ['upload', 'analysis', 'heatmap', 'gridDetails', 'reports'];
                if (panelOrder[index] === panelId) {
                    item.classList.add('active');
                }
            });
            
            currentPanel = panelId;
            
            // Update data if needed
            if (panelId === 'analysis' && analysisData) {
                updateAnalysisDashboard();
            } else if (panelId === 'heatmap' && analysisData) {
                renderHeatmap();
            } else if (panelId === 'reports' && analysisData) {
                updateReports();
            }
        }
        
        // File Handling
        function openFilePicker(fileId) {
            document.getElementById(fileId).click();
        }
        
        function handleFileSelect(fileType, input) {
            const file = input.files[0];
            if (!file) return;
            
            uploadedFiles[fileType] = file;
            
            // Update UI
            const fileNameElement = document.getElementById(fileType + 'FileName');
            const statusElement = document.getElementById(fileType + 'Status');
            
            fileNameElement.textContent = file.name;
            fileNameElement.style.color = 'var(--primary)';
            fileNameElement.style.fontWeight = '600';
            
            statusElement.classList.add('uploaded');
            
            showAlert(`‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå ${fileType} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${file.name}`, 'info');
            
            // Read file immediately to show data
            readFileData(file, fileType);
        }
        
        function readFileData(file, fileType) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    const lines = content.split('\n');
                    const headers = lines[0].split(',').map(h => h.trim());
                    
                    // Count rows (excluding header)
                    const rowCount = Math.max(0, lines.length - 1);
                    
                    // Parse some sample data
                    const sampleData = {};
                    if (lines.length > 1) {
                        const firstRow = lines[1].split(',');
                        headers.forEach((header, index) => {
                            if (index < firstRow.length) {
                                sampleData[header] = firstRow[index].trim();
                            }
                        });
                    }
                    
                    // Update summary based on file type
                    updateFileSummary(fileType, headers, rowCount, sampleData);
                    
                } catch (error) {
                    console.error('Error reading file:', error);
                }
            };
            
            reader.readAsText(file, 'UTF-8');
        }
        
        function updateFileSummary(fileType, headers, rowCount, sampleData) {
            let summary = '';
            
            if (fileType === 'grid') {
                summary = `
                    <div style="margin-bottom: 10px;">
                        <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏ñ‡∏ß‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:</strong> ${rowCount} ‡πÅ‡∏ñ‡∏ß
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${headers.join(', ')}
                    </div>
                    <div style="margin-top: 15px; background: rgba(52, 152, 219, 0.1); padding: 10px; border-radius: 6px;">
                        <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ñ‡∏ß‡πÅ‡∏£‡∏Å:</strong>
                        <div style="margin-top: 5px; font-size: 13px;">
                            ${Object.entries(sampleData).map(([key, value]) => 
                                `<div><strong>${key}:</strong> ${value}</div>`
                            ).join('')}
                        </div>
                    </div>
                `;
                document.getElementById('gridSummary').innerHTML = summary;
            } else if (fileType === 'kat6768' || fileType === 'kat6869') {
                const season = fileType === 'kat6768' ? '67/68' : '68/69';
                summary = `
                    <div style="margin-bottom: 10px;">
                        <strong>‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏•:</strong> ${season}
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÅ‡∏õ‡∏•‡∏á:</strong> ${rowCount} ‡πÅ‡∏õ‡∏•‡∏á
                    </div>
                    <div style="margin-bottom: 10px;">
                        <strong>‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå‡∏ó‡∏µ‡πà‡∏û‡∏ö:</strong> ${headers.join(', ')}
                    </div>
                    ${rowCount > 0 ? `
                    <div style="margin-top: 15px; background: rgba(155, 89, 182, 0.1); padding: 10px; border-radius: 6px;">
                        <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏õ‡∏•‡∏á‡πÅ‡∏£‡∏Å:</strong>
                        <div style="margin-top: 5px; font-size: 13px;">
                            ${Object.entries(sampleData).map(([key, value]) => 
                                `<div><strong>${key}:</strong> ${value}</div>`
                            ).join('')}
                        </div>
                    </div>
                    ` : ''}
                `;
                
                const katSummary = document.getElementById('katSummary');
                if (katSummary.innerHTML.includes('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå')) {
                    katSummary.innerHTML = '';
                }
                
                katSummary.innerHTML += `<div style="margin-bottom: 20px;">${summary}</div>`;
            }
        }
        
        function clearAllFiles() {
            // Reset file inputs
            ['gridFile', 'kat6768File', 'kat6869File'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // Reset file names and status
            ['grid', 'kat6768', 'kat6869'].forEach(type => {
                document.getElementById(type + 'FileName').textContent = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå';
                document.getElementById(type + 'FileName').style.color = '';
                document.getElementById(type + 'FileName').style.fontWeight = '';
                document.getElementById(type + 'Status').classList.remove('uploaded');
            });
            
            // Reset uploaded files object
            uploadedFiles = { grid: null, kat6768: null, kat6869: null };
            
            // Reset summaries
            document.getElementById('gridSummary').innerHTML = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå';
            document.getElementById('katSummary').innerHTML = '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå';
            
            // Reset analysis data
            analysisData = null;
            
            showAlert('‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'info');
        }
        
        // Validation and Analysis
        async function validateAndAnalyze() {
            // Show loading
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÑ‡∏ü‡∏•‡πå...');
            
            try {
                // Check for required files
                if (!uploadedFiles.grid) {
                    throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• GRID (‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)');
                }
                
                if (!uploadedFiles.kat6768 && !uploadedFiles.kat6869) {
                    throw new Error('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå KAT ‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ 1 ‡πÑ‡∏ü‡∏•‡πå (67/68 ‡∏´‡∏£‡∏∑‡∏≠ 68/69)');
                }
                
                // Read all files
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡πà‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå...');
                
                const gridData = await readCSVFile(uploadedFiles.grid);
                const kat6768Data = uploadedFiles.kat6768 ? await readCSVFile(uploadedFiles.kat6768) : null;
                const kat6869Data = uploadedFiles.kat6869 ? await readCSVFile(uploadedFiles.kat6869) : null;
                
                // Validate file structures
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                
                validateFileStructures(gridData, kat6768Data, kat6869Data);
                
                // Analyze data
                showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...');
                
                analysisData = analyzeData(gridData, kat6768Data, kat6869Data);
                
                // Update UI
                hideLoading();
                showAlert('‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏¥‡πâ‡∏ô!', 'info');
                
                // Show analysis panel
                showPanel('analysis');
                updateAnalysisDashboard();
                updateHeaderStats();
                
            } catch (error) {
                hideLoading();
                showAlert(error.message, 'error');
                console.error('Analysis error:', error);
            }
        }
        
        async function readCSVFile(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const content = e.target.result;
                        const lines = content.split('\n').filter(line => line.trim() !== '');
                        
                        if (lines.length === 0) {
                            reject(new Error(`‡πÑ‡∏ü‡∏•‡πå ${file.name} ‡∏ß‡πà‡∏≤‡∏á‡πÄ‡∏õ‡∏•‡πà‡∏≤`));
                            return;
                        }
                        
                        const headers = lines[0].split(',').map(h => h.trim());
                        const data = [];
                        
                        for (let i = 1; i < lines.length; i++) {
                            const values = lines[i].split(',');
                            const row = {};
                            
                            headers.forEach((header, index) => {
                                if (index < values.length) {
                                    row[header] = values[index].trim();
                                } else {
                                    row[header] = '';
                                }
                            });
                            
                            data.push(row);
                        }
                        
                        resolve({
                            filename: file.name,
                            headers: headers,
                            data: data,
                            count: data.length
                        });
                        
                    } catch (error) {
                        reject(new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå ${file.name}: ${error.message}`));
                    }
                };
                
                reader.onerror = function() {
                    reject(new Error(`‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏ü‡∏•‡πå ${file.name}`));
                };
                
                reader.readAsText(file, 'UTF-8');
            });
        }
        
        function validateFileStructures(gridData, kat6768Data, kat6869Data) {
            // Validate GRID file
            if (!gridData.headers.includes('Grid')) {
                throw new Error('‡πÑ‡∏ü‡∏•‡πå GRID ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "Grid"');
            }
            
            if (!gridData.headers.includes('landno')) {
                throw new Error('‡πÑ‡∏ü‡∏•‡πå GRID ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "landno"');
            }
            
            // Validate KAT files
            const validateKatFile = (katData, season) => {
                if (katData) {
                    if (!katData.headers.includes('Grid')) {
                        throw new Error(`‡πÑ‡∏ü‡∏•‡πå KAT ${season} ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "Grid"`);
                    }
                    
                    if (!katData.headers.includes('‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech')) {
                        throw new Error(`‡πÑ‡∏ü‡∏•‡πå KAT ${season} ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech"`);
                    }
                    
                    if (!katData.headers.includes('‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà')) {
                        throw new Error(`‡πÑ‡∏ü‡∏•‡πå KAT ${season} ‡∏ï‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏Ñ‡∏≠‡∏•‡∏±‡∏°‡∏ô‡πå "‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà"`);
                    }
                }
            };
            
            validateKatFile(kat6768Data, '67/68');
            validateKatFile(kat6869Data, '68/69');
        }
        
        function analyzeData(gridData, kat6768Data, kat6869Data) {
            // Extract unique Grids from GRID file
            const gridIds = [...new Set(gridData.data.map(row => row.Grid))];
            
            // Count landno (‡πÅ‡∏õ‡∏•‡∏á) in each Grid
            const gridPlots = {};
            gridData.data.forEach(row => {
                const grid = row.Grid;
                if (!gridPlots[grid]) {
                    gridPlots[grid] = {
                        landnos: new Set(),
                        basicInfo: {}
                    };
                }
                gridPlots[grid].landnos.add(row.landno);
                
                // Store basic info from first occurrence
                if (!gridPlots[grid].basicInfo.zone && row.‡πÄ‡∏Ç‡∏ï) {
                    gridPlots[grid].basicInfo = {
                        zone: row.‡πÄ‡∏Ç‡∏ï || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                        farmerCode: row.‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£ || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                        agriculturist: row.‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£ || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                        farmerName: row.‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏',
                        sugarcaneType: row.‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡πâ‡∏≠‡∏¢ || '‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏'
                    };
                }
            });
            
            // Analyze KAT 67/68 data
            const kat6768Analysis = analyzeKatData(kat6768Data, '67/68', gridPlots);
            
            // Analyze KAT 68/69 data
            const kat6869Analysis = analyzeKatData(kat6869Data, '68/69', gridPlots);
            
            // Combine analysis
            const analysis = {
                gridCount: gridIds.length,
                totalPlotsInGrid: Object.values(gridPlots).reduce((sum, grid) => sum + grid.landnos.size, 0),
                gridDetails: {},
                kat6768: kat6768Analysis,
                kat6869: kat6869Analysis,
                summary: {
                    matchedPlots: 0,
                    criticalPlots: 0,
                    avgYield: 0,
                    gradeDistribution: {
                        high: 0,
                        medium: 0,
                        improve: 0,
                        low: 0
                    }
                }
            };
            
            // Process each Grid
            gridIds.forEach(gridId => {
                const gridInfo = gridPlots[gridId] || { landnos: new Set(), basicInfo: {} };
                const kat6768Grid = kat6768Analysis.gridData[gridId] || { plots: [], critical: [] };
                const kat6869Grid = kat6869Analysis.gridData[gridId] || { plots: [], critical: [] };
                
                // Calculate matched plots
                const matchedPlots6768 = kat6768Grid.plots.filter(plot => 
                    gridInfo.landnos.has(plot.landno)
                ).length;
                
                const matchedPlots6869 = kat6869Grid.plots.filter(plot => 
                    gridInfo.landnos.has(plot.landno)
                ).length;
                
                // Calculate average yield
                const allYields = [
                    ...kat6768Grid.plots.map(p => parseFloat(p.yield) || 0),
                    ...kat6869Grid.plots.map(p => parseFloat(p.yield) || 0)
                ].filter(y => y > 0);
                
                const avgYield = allYields.length > 0 ? 
                    allYields.reduce((a, b) => a + b, 0) / allYields.length : 0;
                
                // Determine grade
                let grade = 'low';
                if (avgYield >= 15) grade = 'high';
                else if (avgYield >= 10) grade = 'medium';
                else if (avgYield >= 7) grade = 'improve';
                
                analysis.summary.gradeDistribution[grade]++;
                
                // Count critical plots
                const criticalPlots = [
                    ...kat6768Grid.critical,
                    ...kat6869Grid.critical
                ];
                
                analysis.summary.criticalPlots += criticalPlots.length;
                analysis.summary.matchedPlots += matchedPlots6768 + matchedPlots6869;
                
                // Store Grid details
                analysis.gridDetails[gridId] = {
                    gridId: gridId,
                    basicInfo: gridInfo.basicInfo,
                    totalPlots: gridInfo.landnos.size,
                    kat6768: {
                        totalPlots: kat6768Grid.plots.length,
                        matchedPlots: matchedPlots6768,
                        plots: kat6768Grid.plots,
                        critical: kat6768Grid.critical
                    },
                    kat6869: {
                        totalPlots: kat6869Grid.plots.length,
                        matchedPlots: matchedPlots6869,
                        plots: kat6869Grid.plots,
                        critical: kat6869Grid.critical
                    },
                    avgYield: avgYield,
                    grade: grade,
                    criticalPlots: criticalPlots
                };
            });
            
            // Calculate overall average yield
            const allGridYields = Object.values(analysis.gridDetails)
                .map(grid => grid.avgYield)
                .filter(y => y > 0);
            
            analysis.summary.avgYield = allGridYields.length > 0 ?
                allGridYields.reduce((a, b) => a + b, 0) / allGridYields.length : 0;
            
            return analysis;
        }
        
        function analyzeKatData(katData, season, gridPlots) {
            if (!katData) {
                return {
                    season: season,
                    totalPlots: 0,
                    gridData: {},
                    criticalPlots: []
                };
            }
            
            const gridData = {};
            const criticalPlots = [];
            
            // Group by Grid
            katData.data.forEach(row => {
                const grid = row.Grid;
                if (!gridData[grid]) {
                    gridData[grid] = {
                        plots: [],
                        critical: []
                    };
                }
                
                const plot = {
                    landno: row.‡πÄ‡∏•‡∏Ç‡πÅ‡∏õ‡∏•‡∏áintech || '',
                    quota: row.‡πÄ‡∏•‡∏Ç‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤ || '',
                    yield: parseFloat(row['‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà']) || 0,
                    area: parseFloat(row.‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà) || 0,
                    season: season
                };
                
                gridData[grid].plots.push(plot);
                
                // Check if critical (yield < 7)
                if (plot.yield > 0 && plot.yield < 7) {
                    gridData[grid].critical.push(plot);
                    criticalPlots.push({
                        grid: grid,
                        ...plot
                    });
                }
            });
            
            return {
                season: season,
                totalPlots: katData.count,
                gridData: gridData,
                criticalPlots: criticalPlots
            };
        }
        
        // Update Dashboard
        function updateAnalysisDashboard() {
            if (!analysisData) return;
            
            // Update metric cards
            document.getElementById('totalGridCount').textContent = analysisData.gridCount;
            document.getElementById('kat6768Plots').textContent = analysisData.kat6768.totalPlots;
            document.getElementById('kat6869Plots').textContent = analysisData.kat6869.totalPlots;
            document.getElementById('matchedPlots').textContent = analysisData.summary.matchedPlots;
            document.getElementById('criticalPlots').textContent = analysisData.summary.criticalPlots;
            document.getElementById('avgYield').textContent = analysisData.summary.avgYield.toFixed(1);
            
            // Update detailed summary
            let gridSummary = `
                <div style="margin-bottom: 15px;">
                    <strong>Grid ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î:</strong> ${analysisData.gridCount} Grid
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GRID:</strong> ${analysisData.totalPlotsInGrid} ‡πÅ‡∏õ‡∏•‡∏á
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡πà‡∏≤‡∏ô‡πÑ‡∏î‡πâ:</strong>
                </div>
            `;
            
            // Show basic info from first few Grids
            const sampleGrids = Object.keys(analysisData.gridDetails).slice(0, 3);
            sampleGrids.forEach(gridId => {
                const grid = analysisData.gridDetails[gridId];
                gridSummary += `
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 10px; border-radius: 6px; margin-bottom: 10px;">
                        <strong>${gridId}:</strong> ‡πÄ‡∏Ç‡∏ï ${grid.basicInfo.zone}, ${grid.basicInfo.farmerName}
                    </div>
                `;
            });
            
            if (sampleGrids.length < Object.keys(analysisData.gridDetails).length) {
                gridSummary += `<div style="color: var(--gray); font-size: 13px;">‡πÅ‡∏•‡∏∞ Grid ‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏≠‡∏µ‡∏Å ${analysisData.gridCount - sampleGrids.length} Grid</div>`;
            }
            
            document.getElementById('gridSummary').innerHTML = gridSummary;
            
            // Update KAT summary
            let katSummary = `
                <div style="margin-bottom: 15px;">
                    <strong>KAT 67/68:</strong> ${analysisData.kat6768.totalPlots} ‡πÅ‡∏õ‡∏•‡∏á
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>KAT 68/69:</strong> ${analysisData.kat6869.totalPlots} ‡πÅ‡∏õ‡∏•‡∏á
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ (landno ‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô):</strong> ${analysisData.summary.matchedPlots} ‡πÅ‡∏õ‡∏•‡∏á
                </div>
                <div style="margin-bottom: 15px;">
                    <strong>‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà):</strong> ${analysisData.summary.criticalPlots} ‡πÅ‡∏õ‡∏•‡∏á
                </div>
            `;
            
            // Show critical plots if any
            if (analysisData.summary.criticalPlots > 0) {
                const criticalSamples = [];
                Object.values(analysisData.gridDetails).forEach(grid => {
                    if (grid.criticalPlots.length > 0) {
                        criticalSamples.push({
                            grid: grid.gridId,
                            plot: grid.criticalPlots[0]
                        });
                    }
                });
                
                if (criticalSamples.length > 0) {
                    katSummary += `
                        <div style="background: rgba(231, 76, 60, 0.1); padding: 10px; border-radius: 6px; margin-top: 15px;">
                            <strong>‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï:</strong>
                            ${criticalSamples.slice(0, 3).map(sample => `
                                <div style="margin-top: 5px; font-size: 13px;">
                                    ${sample.grid}: ‡πÅ‡∏õ‡∏•‡∏á ${sample.plot.landno} - ${sample.plot.yield} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà (${sample.plot.season})
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
            }
            
            document.getElementById('katSummary').innerHTML = katSummary;
        }
        
        function updateHeaderStats() {
            if (!analysisData) return;
            
            document.getElementById('headerGrids').textContent = analysisData.gridCount;
            document.getElementById('headerPlots').textContent = analysisData.summary.matchedPlots;
            document.getElementById('headerProblems').textContent = analysisData.summary.criticalPlots;
            document.getElementById('headerYield').textContent = analysisData.summary.avgYield.toFixed(1);
        }
        
        // Heatmap Functions
        function renderHeatmap() {
            if (!analysisData) return;
            
            const container = document.getElementById('heatmapContainer');
            container.innerHTML = '';
            
            const gradeCounts = {
                high: 0,
                medium: 0,
                improve: 0,
                low: 0
            };
            
            // Create heatmap cells
            Object.values(analysisData.gridDetails).forEach(grid => {
                const cell = document.createElement('div');
                cell.className = `heatmap-cell ${grid.grade}`;
                cell.textContent = grid.gridId;
                cell.title = `${grid.gridId}: ${grid.avgYield.toFixed(1)} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà (${grid.grade})`;
                
                cell.onclick = () => {
                    showPanel('gridDetails');
                    document.getElementById('gridSelector').value = grid.gridId;
                    loadGridDetails(grid.gridId);
                };
                
                container.appendChild(cell);
                gradeCounts[grid.grade]++;
            });
            
            // Update grade counts
            document.getElementById('highCount').textContent = gradeCounts.high;
            document.getElementById('mediumCount').textContent = gradeCounts.medium;
            document.getElementById('improveCount').textContent = gradeCounts.improve;
            document.getElementById('lowCount').textContent = gradeCounts.low;
        }
        
        function filterHeatmap(grade) {
            // In a real implementation, this would filter the heatmap display
            showAlert(`‡πÅ‡∏™‡∏î‡∏á Grid ‡πÄ‡∏Å‡∏£‡∏î: ${grade === 'all' ? '‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î' : grade}`, 'info');
            renderHeatmap(); // Re-render with current filter
        }
        
        // Grid Details Functions
        function loadGridDetails(gridId) {
            if (!analysisData || !analysisData.gridDetails[gridId]) {
                showAlert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Grid ‡∏ô‡∏µ‡πâ', 'error');
                return;
            }
            
            const grid = analysisData.gridDetails[gridId];
            const content = document.getElementById('gridDetailsContent');
            
            // Calculate match rates
            const matchRate6768 = grid.kat6768.totalPlots > 0 ? 
                (grid.kat6768.matchedPlots / grid.kat6768.totalPlots * 100).toFixed(1) : 0;
                
            const matchRate6869 = grid.kat6869.totalPlots > 0 ? 
                (grid.kat6869.matchedPlots / grid.kat6869.totalPlots * 100).toFixed(1) : 0;
            
            // Get grade color and icon
            const gradeConfig = {
                high: { color: '#27ae60', icon: 'üü¢', label: '‡∏™‡∏π‡∏á' },
                medium: { color: '#f1c40f', icon: 'üü°', label: '‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á' },
                improve: { color: '#f39c12', icon: 'üü†', label: '‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á' },
                low: { color: '#e74c3c', icon: 'üî¥', label: '‡∏ï‡πà‡∏≥' }
            };
            
            const grade = gradeConfig[grid.grade];
            
            // Build HTML
            let html = `
                <div style="margin-bottom: 30px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <div>
                            <h2 style="color: var(--primary);">Grid: ${grid.gridId}</h2>
                            <p style="color: var(--gray);">‡πÄ‡∏Ç‡∏ï: ${grid.basicInfo.zone}</p>
                        </div>
                        <div style="background: ${grade.color}; color: white; padding: 10px 20px; border-radius: 8px; font-weight: 600;">
                            ${grade.icon} ‡πÄ‡∏Å‡∏£‡∏î: ${grade.label} (${grid.avgYield.toFixed(1)} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà)
                        </div>
                    </div>
                    
                    <div class="info-grid">
                        <div class="info-item">
                            <div class="info-label">‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£</div>
                            <div class="info-value">${grid.basicInfo.farmerCode}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ô‡∏±‡∏Å‡πÄ‡∏Å‡∏©‡∏ï‡∏£</div>
                            <div class="info-value">${grid.basicInfo.agriculturist}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">‡∏ä‡∏∑‡πà‡∏≠‡∏ä‡∏≤‡∏ß‡πÑ‡∏£‡πà</div>
                            <div class="info-value">${grid.basicInfo.farmerName}</div>
                        </div>
                        <div class="info-item">
                            <div class="info-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡πâ‡∏≠‡∏¢</div>
                            <div class="info-value">${grid.basicInfo.sugarcaneType}</div>
                        </div>
                    </div>
                </div>
                
                <div style="margin-bottom: 30px;">
                    <h3 style="color: var(--primary); margin-bottom: 20px;">‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á</h3>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div style="background: rgba(52, 152, 219, 0.1); padding: 20px; border-radius: 10px;">
                            <div style="font-size: 14px; color: var(--gray);">‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GRID</div>
                            <div style="font-size: 28px; font-weight: 700; color: var(--primary);">${grid.totalPlots}</div>
                        </div>
            `;
            
            if (grid.kat6768.totalPlots > 0) {
                html += `
                    <div style="background: rgba(52, 152, 219, 0.1); padding: 20px; border-radius: 10px;">
                        <div style="font-size: 14px; color: var(--gray);">‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 67/68</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--primary);">${grid.kat6768.totalPlots}</div>
                        <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ ${grid.kat6768.matchedPlots} ‡πÅ‡∏õ‡∏•‡∏á (${matchRate6768}%)</div>
                    </div>
                `;
            }
            
            if (grid.kat6869.totalPlots > 0) {
                html += `
                    <div style="background: rgba(155, 89, 182, 0.1); padding: 20px; border-radius: 10px;">
                        <div style="font-size: 14px; color: var(--gray);">‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 68/69</div>
                        <div style="font-size: 28px; font-weight: 700; color: var(--primary);">${grid.kat6869.totalPlots}</div>
                        <div style="font-size: 12px; color: var(--gray); margin-top: 5px;">‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ ${grid.kat6869.matchedPlots} ‡πÅ‡∏õ‡∏•‡∏á (${matchRate6869}%)</div>
                    </div>
                `;
            }
            
            html += `
                    </div>
                </div>
            `;
            
            // Show critical plots if any
            if (grid.criticalPlots.length > 0) {
                html += `
                    <div style="margin-bottom: 30px;">
                        <h3 style="color: var(--danger); margin-bottom: 20px;">
                            <i class="fas fa-exclamation-triangle"></i> ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà)
                        </h3>
                        <div class="critical-plots-grid">
                `;
                
                grid.criticalPlots.forEach((plot, index) => {
                    html += `
                        <div class="plot-card" onclick="showPlotDetails('${grid.gridId}', ${index})">
                            <div class="season-badge ${plot.season === '67/68' ? 'season-6768' : 'season-6869'}">
                                ‡∏§‡∏î‡∏π‡∏Å‡∏≤‡∏• ${plot.season}
                            </div>
                            <div style="font-weight: 600; color: var(--primary); margin-bottom: 5px;">‡πÅ‡∏õ‡∏•‡∏á ${plot.landno}</div>
                            <div style="color: var(--danger); font-size: 24px; font-weight: 700; margin: 10px 0;">${plot.yield.toFixed(1)} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà</div>
                            <div style="color: var(--gray); font-size: 14px;">
                                <div>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${plot.area} ‡πÑ‡∏£‡πà</div>
                                <div>‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤: ${plot.quota}</div>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
            
            content.innerHTML = html;
            
            // Populate grid selector if not already
            const selector = document.getElementById('gridSelector');
            if (selector.options.length <= 1) {
                Object.keys(analysisData.gridDetails).forEach(gId => {
                    if (!Array.from(selector.options).some(opt => opt.value === gId)) {
                        const option = document.createElement('option');
                        option.value = gId;
                        option.textContent = `${gId} (${analysisData.gridDetails[gId].basicInfo.zone})`;
                        selector.appendChild(option);
                    }
                });
            }
        }
        
        function showPlotDetails(gridId, plotIndex) {
            const grid = analysisData.gridDetails[gridId];
            if (!grid || !grid.criticalPlots[plotIndex]) return;
            
            const plot = grid.criticalPlots[plotIndex];
            
            showAlert(`‡πÅ‡∏õ‡∏•‡∏á ${plot.landno}: ${plot.yield.toFixed(1)} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà (${plot.season})`, 'warning');
        }
        
        // Reports Functions
        function updateReports() {
            if (!analysisData) return;
            
            document.getElementById('reportGrids').textContent = analysisData.gridCount;
            document.getElementById('reportProblems').textContent = Object.values(analysisData.gridDetails)
                .filter(grid => grid.criticalPlots.length > 0).length;
            document.getElementById('reportCritical').textContent = analysisData.summary.criticalPlots;
            
            // Update recommendations
            const recommendations = document.getElementById('recommendations');
            
            // Identify problematic grids
            const problematicGrids = Object.values(analysisData.gridDetails)
                .filter(grid => grid.grade === 'low' || grid.criticalPlots.length > 0);
            
            const lowYieldGrids = Object.values(analysisData.gridDetails)
                .filter(grid => grid.avgYield < 7);
            
            const urgentIssues = [];
            const recommendationsList = [];
            const improvements = [];
            
            if (lowYieldGrids.length > 0) {
                urgentIssues.push(`‡∏°‡∏µ Grid ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≥ ${lowYieldGrids.length} Grid (‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ 7 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà)`);
                urgentIssues.push(`Grid ‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏î‡πà‡∏ß‡∏ô: ${lowYieldGrids.slice(0, 3).map(g => g.gridId).join(', ')}`);
            }
            
            if (analysisData.summary.criticalPlots > 0) {
                urgentIssues.push(`‡∏°‡∏µ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï ${analysisData.summary.criticalPlots} ‡πÅ‡∏õ‡∏•‡∏á`);
                recommendationsList.push(`‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï‡πÉ‡∏ô Grid ‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤`);
            }
            
            recommendationsList.push(`‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ô`);
            recommendationsList.push(`‡∏à‡∏±‡∏î‡∏≠‡∏ö‡∏£‡∏°‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡∏ï‡πà‡∏≥`);
            
            improvements.push(`‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏´‡πâ‡∏á‡πÅ‡∏•‡πâ‡∏á`);
            improvements.push(`‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πã‡∏¢‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏î‡∏¥‡∏ô`);
            improvements.push(`‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡πÅ‡∏õ‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏ú‡∏•`);
            
            recommendations.innerHTML = `
                <div style="background: rgba(231, 76, 60, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--danger);">
                    <h4 style="color: var(--danger); margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle"></i> ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏î‡πà‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç
                    </h4>
                    <ul style="color: var(--gray); padding-left: 20px;">
                        ${urgentIssues.map(issue => `<li>${issue}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(243, 156, 18, 0.1); padding: 20px; border-radius: 10px; margin-bottom: 20px; border-left: 5px solid var(--warning);">
                    <h4 style="color: var(--warning); margin-bottom: 10px;">
                        <i class="fas fa-clipboard-check"></i> ‡∏Ñ‡∏ß‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£
                    </h4>
                    <ul style="color: var(--gray); padding-left: 20px;">
                        ${recommendationsList.map(rec => `<li>${rec}</li>`).join('')}
                    </ul>
                </div>
                
                <div style="background: rgba(39, 174, 96, 0.1); padding: 20px; border-radius: 10px; border-left: 5px solid var(--success);">
                    <h4 style="color: var(--success); margin-bottom: 10px;">
                        <i class="fas fa-chart-line"></i> ‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á
                    </h4>
                    <ul style="color: var(--gray); padding-left: 20px;">
                        ${improvements.map(imp => `<li>${imp}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        function exportPDFReport() {
            if (!analysisData) {
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'warning');
                return;
            }
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF...');
            
            // Simulate PDF generation
            setTimeout(() => {
                hideLoading();
                showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô PDF ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'info');
                
                // Create a simple text report for download
                const reportContent = createTextReport();
                downloadFile(reportContent, '‡∏≠‡πâ‡∏≠‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå_‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô.pdf', 'application/pdf');
            }, 2000);
        }
        
        function exportExcelReport() {
            if (!analysisData) {
                showAlert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡πà‡∏≠‡∏ô‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô', 'warning');
                return;
            }
            
            showLoading('‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel...');
            
            // Simulate Excel generation
            setTimeout(() => {
                hideLoading();
                showAlert('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', 'info');
                
                // Create a simple CSV report for download
                const csvContent = createCSVReport();
                downloadFile(csvContent, '‡∏≠‡πâ‡∏≠‡∏¢‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå_‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô.csv', 'text/csv');
            }, 2000);
        }
        
        function createTextReport() {
            let report = `‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏õ‡∏•‡∏á‡∏≠‡πâ‡∏≠‡∏¢\n`;
            report += `‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${new Date().toLocaleDateString('th-TH')}\n`;
            report += `‡πÄ‡∏ß‡∏•‡∏≤: ${new Date().toLocaleTimeString('th-TH')}\n\n`;
            
            report += `‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå:\n`;
            report += `- Grid ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${analysisData.gridCount}\n`;
            report += `- ‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô‡πÑ‡∏ü‡∏•‡πå GRID: ${analysisData.totalPlotsInGrid}\n`;
            report += `- ‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 67/68: ${analysisData.kat6768.totalPlots}\n`;
            report += `- ‡πÅ‡∏õ‡∏•‡∏á‡πÉ‡∏ô KAT 68/69: ${analysisData.kat6869.totalPlots}\n`;
            report += `- ‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡πÑ‡∏î‡πâ: ${analysisData.summary.matchedPlots}\n`;
            report += `- ‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï: ${analysisData.summary.criticalPlots}\n`;
            report += `- ‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢: ${analysisData.summary.avgYield.toFixed(1)} ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà\n\n`;
            
            report += `‡πÄ‡∏Å‡∏£‡∏î‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï:\n`;
            report += `- ‡∏™‡∏π‡∏á (>15 ‡∏ï‡∏±‡∏ô/‡πÑ‡∏£‡πà): ${analysisData.summary.gradeDistribution.high} Grid\n`;
            report += `- ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á (10-15): ${analysisData.summary.gradeDistribution.medium} Grid\n`;
            report += `- ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á (7-10): ${analysisData.summary.gradeDistribution.improve} Grid\n`;
            report += `- ‡∏ï‡πà‡∏≥ (<7): ${analysisData.summary.gradeDistribution.low} Grid\n\n`;
            
            return report;
        }
        
        function createCSVReport() {
            let csv = 'Grid,‡πÄ‡∏Ç‡∏ï,‡πÄ‡∏Å‡∏©‡∏ï‡∏£‡∏Å‡∏£,‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏≠‡πâ‡∏≠‡∏¢,‡πÅ‡∏õ‡∏•‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î,‡πÅ‡∏õ‡∏•‡∏á‡∏ß‡∏¥‡∏Å‡∏§‡∏ï,‡∏ú‡∏•‡∏ú‡∏•‡∏¥‡∏ï‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢,‡πÄ‡∏Å‡∏£‡∏î\n';
            
            Object.values(analysisData.gridDetails).forEach(grid => {
                csv += `${grid.gridId},`;
                csv += `${grid.basicInfo.zone},`;
                csv += `${grid.basicInfo.farmerName},`;
                csv += `${grid.basicInfo.sugarcaneType},`;
                csv += `${grid.totalPlots},`;
                csv += `${grid.criticalPlots.length},`;
                csv += `${grid.avgYield.toFixed(1)},`;
                csv += `${grid.grade}\n`;
            });
            
            return csv;
        }
        
        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type: type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
        
        // Loading Functions
        function showLoading(message) {
            document.getElementById('loadingOverlay').classList.add('active');
            document.getElementById('loadingMessage').textContent = message || '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('active');
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Set initial panel
            showPanel('upload');
            
            // Add some sample data for demonstration
            setTimeout(() => {
                // This would be replaced with actual file upload in production
                console.log('‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô');
            }, 1000);
        });
    </script>
</body>
</html>
